<!DOCTYPE html>
<html lang="th">
  <head>
    <meta charset="UTF-8" />
    <title>‡πÇ‡∏õ‡∏£‡πÅ‡∏Å‡∏£‡∏°‡πÅ‡∏õ‡∏•‡∏á‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏£‡∏µ‡∏¢‡∏•‡πÑ‡∏ó‡∏°‡πå</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="icon" href="https://cdn-icons-png.flaticon.com/512/10826/10826388.png">
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <style>
      body {
        background: linear-gradient(135deg, #f0f9ff, #cbebff);
        font-family: "Prompt", sans-serif;
      }
      .card {
        border-radius: 12px;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
      }
      .spinner-border {
        display: none;
        margin: 10px auto;
      }
    </style>
  </head>
  <body class="d-flex flex-column align-items-center p-3">
    <div class="container mt-4">
      <div class="row justify-content-center">
        <div class="col-lg-6 col-md-8 col-sm-10">
          <div class="card p-4">
            <h3 class="text-center">‡πÇ‡∏õ‡∏£‡πÅ‡∏Å‡∏£‡∏°‡πÅ‡∏õ‡∏•‡∏á‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏£‡∏µ‡∏¢‡∏•‡πÑ‡∏ó‡∏°‡πå</h3>
            <h5 class="text-center mb-3">Frankfurter API</h5>

            <div class="mb-3">
              <label>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô</label>
              <input
                id="amount"
                type="number"
                class="form-control"
                placeholder="‡∏Å‡∏£‡∏≠‡∏Å‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô"
                step="0.01"
              />
            </div>

            <div class="row align-items-end mb-3">
              <div class="col-5">
                <label>‡∏à‡∏≤‡∏Å</label>
                <select id="from" class="form-select"></select>
              </div>
              <div class="col-2 text-center">
                <button
                  id="swapBtn"
                  class="btn btn-outline-secondary w-100"
                  title="‡∏™‡∏•‡∏±‡∏ö‡∏™‡∏Å‡∏∏‡∏•‡πÄ‡∏á‡∏¥‡∏ô"
                >
                  üîÑ
                </button>
              </div>
              <div class="col-5">
                <label>‡πÄ‡∏õ‡πá‡∏ô</label>
                <select id="to" class="form-select"></select>
              </div>
            </div>

            <button class="btn btn-primary w-100 mb-3" onclick="convert()">
              ‡πÅ‡∏õ‡∏•‡∏á‡∏Ñ‡πà‡∏≤‡πÄ‡∏á‡∏¥‡∏ô
            </button>

            <div class="text-center">
              <div
                class="spinner-border text-primary"
                id="loader"
                role="status"
              ></div>
            </div>

            <div id="result" class="text-center fs-5 text-success mb-3"></div>

            <div class="card p-3">
              <h5 class="text-center">üïí ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡πÅ‡∏õ‡∏•‡∏á‡∏Ñ‡πà‡∏≤‡πÄ‡∏á‡∏¥‡∏ô</h5>

              <div class="d-flex justify-content-between mb-2">
                <button class="btn btn-sm btn-danger" id="clearAllBtn">
                  ‡∏•‡πâ‡∏≤‡∏á‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
                </button>
                <button class="btn btn-sm btn-warning" id="deleteSelectedBtn">
                  ‡∏•‡∏ö‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å
                </button>
              </div>

              <ul
                id="history-list"
                class="list-group list-group-flush"
                style="max-height: 300px; overflow-y: auto"
              ></ul>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div
      class="modal fade"
      id="clearAllModal"
      tabindex="-1"
      aria-labelledby="clearAllModalLabel"
      aria-hidden="true"
    >
      <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
          <div class="modal-header bg-danger text-white">
            <h5 class="modal-title" id="clearAllModalLabel">
              ‡∏•‡πâ‡∏≤‡∏á‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
            </h5>
            <button
              type="button"
              class="btn-close btn-close-white"
              data-bs-dismiss="modal"
              aria-label="Close"
            ></button>
          </div>
          <div class="modal-body">
            ‡∏Ñ‡∏∏‡∏ì‡πÅ‡∏ô‡πà‡πÉ‡∏à‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà‡∏ß‡πà‡∏≤‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡πâ‡∏≤‡∏á‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î?
            ‡∏Å‡∏≤‡∏£‡∏Å‡∏£‡∏∞‡∏ó‡∏≥‡∏ô‡∏µ‡πâ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏¢‡πâ‡∏≠‡∏ô‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏î‡πâ
          </div>
          <div class="modal-footer">
            <button
              type="button"
              class="btn btn-secondary"
              data-bs-dismiss="modal"
            >
              ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å
            </button>
            <button
              type="button"
              class="btn btn-danger"
              id="confirmClearAllBtn"
            >
              ‡∏•‡πâ‡∏≤‡∏á‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
            </button>
          </div>
        </div>
      </div>
    </div>

    <div class="position-fixed bottom-0 end-0 p-3" style="z-index: 11">
      <div id="toastContainer"></div>
    </div>

    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

    <script>
      const fromSelect = document.getElementById("from");
      const toSelect = document.getElementById("to");
      const loader = document.getElementById("loader");
      const historyList = document.getElementById("history-list");

      function formatNumber(num) {
        return Number(num).toLocaleString("en-US", {
          maximumFractionDigits: 2,
        });
      }

      async function loadCurrencies() {
        try {
          const res = await fetch("https://api.frankfurter.app/currencies");
          const data = await res.json();

          fromSelect.innerHTML = "";
          toSelect.innerHTML = "";

          for (const [code, name] of Object.entries(data)) {
            const option = `<option value="${code}">${code} - ${name}</option>`;
            fromSelect.insertAdjacentHTML("beforeend", option);
            toSelect.insertAdjacentHTML("beforeend", option);
          }

          fromSelect.value = "USD";
          toSelect.value = "THB";
        } catch (err) {
          console.error("Failed to load currencies:", err);
          showToast("‚ùå ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÇ‡∏´‡∏•‡∏î‡∏™‡∏Å‡∏∏‡∏•‡πÄ‡∏á‡∏¥‡∏ô‡∏à‡∏≤‡∏Å API ‡πÑ‡∏î‡πâ", "danger");
        }
      }

      loadCurrencies();

      document.getElementById("swapBtn").addEventListener("click", () => {
        const temp = fromSelect.value;
        fromSelect.value = toSelect.value;
        toSelect.value = temp;
      });

      const history = JSON.parse(localStorage.getItem("history") || "[]");
      history.forEach(addHistoryItem);

      function addHistoryItem(h) {
        const item = document.createElement("li");
        item.classList.add("list-group-item", "d-flex", "align-items-center");

        const checkbox = document.createElement("input");
        checkbox.type = "checkbox";
        checkbox.classList.add("me-2");
        item.appendChild(checkbox);

        const text = document.createElement("span");
        text.innerHTML = `${formatNumber(h.amount)} ${
          h.from
        } ‚ûú <b>${formatNumber(h.result)}</b> ${
          h.to
        } <span class="text-muted">(rate: ${h.rate})</span>`;
        item.appendChild(text);

        const delBtn = document.createElement("button");
        delBtn.classList.add("btn", "btn-sm", "btn-outline-danger", "ms-auto");
        delBtn.textContent = "‚ùå";
        delBtn.onclick = () => {
          historyList.removeChild(item);
          const idx = history.indexOf(h);
          if (idx > -1) history.splice(idx, 1);
          localStorage.setItem("history", JSON.stringify(history));
          showToast("üóëÔ∏è ‡∏•‡∏ö‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢", "warning");
        };
        item.appendChild(delBtn);

        historyList.prepend(item);
      }

      function showToast(message, type = "success") {
        const toastId = "toast" + Date.now();
        const toastHTML = `
        <div id="${toastId}" class="toast align-items-center text-white bg-${type} border-0 mb-2" role="alert" aria-live="assertive" aria-atomic="true">
          <div class="d-flex">
            <div class="toast-body">${message}</div>
            <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast" aria-label="Close"></button>
          </div>
        </div>`;
        const container = document.getElementById("toastContainer");
        container.insertAdjacentHTML("beforeend", toastHTML);
        const toastEl = document.getElementById(toastId);
        const toast = new bootstrap.Toast(toastEl, { delay: 3000 });
        toast.show();
      }

      document.getElementById("clearAllBtn").addEventListener("click", () => {
        const clearModal = new bootstrap.Modal(
          document.getElementById("clearAllModal")
        );
        clearModal.show();
      });

      document
        .getElementById("confirmClearAllBtn")
        .addEventListener("click", () => {
          historyList.innerHTML = "";
          history.length = 0;
          localStorage.removeItem("history");
          showToast("‚úÖ ‡∏•‡πâ‡∏≤‡∏á‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß", "success");
          const clearModal = bootstrap.Modal.getInstance(
            document.getElementById("clearAllModal")
          );
          clearModal.hide();
        });

      document
        .getElementById("deleteSelectedBtn")
        .addEventListener("click", () => {
          const items = Array.from(historyList.children);
          let removed = 0;
          items.forEach((li, idx) => {
            const cb = li.querySelector("input[type='checkbox']");
            if (cb && cb.checked) {
              historyList.removeChild(li);
              history.splice(idx, 1);
              removed++;
            }
          });
          localStorage.setItem("history", JSON.stringify(history));
          if (removed) showToast(`üóëÔ∏è ‡∏•‡∏ö ${removed} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢`, "warning");
        });

      async function convert() {
        const amount = parseFloat(document.getElementById("amount").value);
        const from = fromSelect.value;
        const to = toSelect.value;

        if (!amount || amount <= 0)
          return showToast("‚ùå ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á", "danger");

        loader.style.display = "inline-block";
        document.getElementById("result").textContent = "";

        try {
          const res = await fetch(
            `https://api.frankfurter.app/latest?amount=${amount}&from=${from}&to=${to}`
          );
          const data = await res.json();
          const result = data.rates[to];
          document.getElementById("result").innerHTML = `${formatNumber(
            amount
          )} ${from} = <b>${formatNumber(
            result
          )}</b> ${to} <br> (‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡πÅ‡∏•‡∏Å‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô: ${data.rates[to] / amount})`;

          const historyItem = {
            amount,
            from,
            to,
            result,
            rate: (data.rates[to] / amount).toFixed(4),
          };
          history.push(historyItem);
          localStorage.setItem("history", JSON.stringify(history));
          addHistoryItem(historyItem);
          showToast(`üí± ‡πÅ‡∏õ‡∏•‡∏á‡∏Ñ‡πà‡∏≤‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢`, "success");
        } catch (err) {
          console.error(err);
          showToast("‚ùå ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÅ‡∏õ‡∏•‡∏á‡∏Ñ‡πà‡∏≤‡πÄ‡∏á‡∏¥‡∏ô", "danger");
        } finally {
          loader.style.display = "none";
        }
      }
    </script>
  </body>
</html>
